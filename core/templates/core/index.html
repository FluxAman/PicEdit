{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<!-- Upload Section -->
<section class="upload-section" id="uploadSection">
    <div class="upload-zone" id="uploadZone">
        <i class="fas fa-cloud-upload-alt upload-icon"></i>
        <h2>Drop image here or click to upload</h2>
        <p>Support for JPEG, PNG, WebP</p>
        <input type="file" id="imageInput" accept="image/*" hidden>
        <button class="btn-primary" onclick="event.stopPropagation(); document.getElementById('imageInput').click()">
            <i class="fas fa-folder-open"></i> Browse Files
        </button>
    </div>

    <!-- Features Showcase -->
    <div class="features-showcase">
        <h3 class="features-title">What You Can Do</h3>
        <div class="feature-cards">
            <div class="feature-card">
                <div class="feature-card-icon">
                    <i class="fas fa-expand-arrows-alt"></i>
                </div>
                <h4>Resize</h4>
                <p>Change image dimensions with aspect ratio lock. Scale up or down to any size.</p>
            </div>
            <div class="feature-card">
                <div class="feature-card-icon">
                    <i class="fas fa-compress-alt"></i>
                </div>
                <h4>Compress</h4>
                <p>Reduce file size to target KB. Perfect for web uploads and email attachments.</p>
            </div>
            <div class="feature-card">
                <div class="feature-card-icon">
                    <i class="fas fa-magic"></i>
                </div>
                <h4>Filters</h4>
                <p>Adjust brightness, contrast, saturation. Apply grayscale, sepia, vintage effects.</p>
            </div>
            <div class="feature-card">
                <div class="feature-card-icon">
                    <i class="fas fa-crop-alt"></i>
                </div>
                <h4>Crop</h4>
                <p>Visual crop with drag handles. Quick presets for 1:1, 4:3, 16:9 ratios.</p>
            </div>
        </div>
    </div>
</section>

<!-- Main Processing Area -->
<div class="processing-area" id="processingArea" style="display: none;">
    <div class="workspace-container">

        <!-- Left Panel: Image Preview -->
        <div class="workspace-left">
            <div class="preview-section">
                <div class="preview-container">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-controls">
                            <button class="btn-icon" id="compareBtn" title="Compare Before/After">
                                <i class="fas fa-columns"></i>
                            </button>
                            <button class="btn-icon" id="resetBtn" title="Reset">
                                <i class="fas fa-undo"></i>
                            </button>
                        </div>
                    </div>

                    <div class="image-preview-wrapper">
                        <div class="comparison-view" id="comparisonView" style="display: none;">
                            <div class="comparison-side">
                                <span class="comparison-label">Original</span>
                                <img id="originalPreview" alt="Original">
                                <p class="image-info" id="originalInfo"></p>
                            </div>
                            <div class="comparison-side">
                                <span class="comparison-label">Processed</span>
                                <img id="processedPreview" alt="Processed">
                                <p class="image-info" id="processedInfo"></p>
                            </div>
                        </div>
                        <div class="single-view" id="singleView">
                            <div class="preview-image-container" id="previewImageContainer">
                                <img id="preview" alt="Preview">
                                <div class="crop-selection" id="cropSelection" style="display: none;">
                                    <div class="crop-handle nw" data-handle="nw"></div>
                                    <div class="crop-handle n" data-handle="n"></div>
                                    <div class="crop-handle ne" data-handle="ne"></div>
                                    <div class="crop-handle w" data-handle="w"></div>
                                    <div class="crop-handle e" data-handle="e"></div>
                                    <div class="crop-handle sw" data-handle="sw"></div>
                                    <div class="crop-handle s" data-handle="s"></div>
                                    <div class="crop-handle se" data-handle="se"></div>
                                    <div class="crop-dimensions" id="cropDimensions">0 × 0</div>
                                </div>
                            </div>
                            <canvas id="canvas" style="display: none;"></canvas>
                        </div>
                    </div>

                    <div class="image-metadata" id="imageMetadata"></div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Controls -->
        <div class="workspace-right">

            <div class="controls-scroll-area">
                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Resize Tab -->
                    <div class="tab-pane active" id="resizeTab">
                        <div class="control-section">
                            <h3><i class="fas fa-sliders-h"></i> Resize Options</h3>
                            <div class="dimension-controls" id="dimensionControls">
                                <div class="control-group">
                                    <label for="width">
                                        Width:
                                        <button class="btn-icon-small" id="lockAspect" title="Lock aspect ratio">
                                            <i class="fas fa-lock"></i>
                                        </button>
                                    </label>
                                    <div class="input-with-unit">
                                        <input type="number" id="width" placeholder="Width" min="1">
                                        <span class="unit">px</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label for="height">Height:</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="height" placeholder="Height" min="1">
                                        <span class="unit">px</span>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="outputFormat">Output Format:</label>
                                <select id="outputFormat">
                                    <option value="png">PNG</option>
                                    <option value="jpeg">JPEG</option>
                                    <option value="webp">WebP</option>
                                </select>
                            </div>
                            <button class="btn-primary btn-large" id="applyResize">
                                <i class="fas fa-check"></i> Apply Resize
                            </button>
                        </div>
                    </div>

                    <!-- Compress Tab -->
                    <div class="tab-pane" id="compressTab">
                        <div class="control-section">
                            <h3><i class="fas fa-compress-arrows-alt"></i> Compress Image</h3>
                            <div class="control-group">
                                <label for="targetSize">Target File Size:</label>
                                <div class="input-with-unit">
                                    <input type="number" id="targetSize" placeholder="e.g., 100" min="1" value="100">
                                    <span class="unit">KB</span>
                                </div>
                            </div>
                            <div class="crop-info">
                                <p><i class="fas fa-info-circle"></i> Image will be compressed to approximately the
                                    target size. Works best with JPEG/WebP formats.</p>
                            </div>
                            <div class="control-group">
                                <label>Current Size: <strong id="currentSizeDisplay">-- KB</strong></label>
                            </div>
                            <div class="control-group">
                                <label>Estimated Output: <strong id="estimatedSizeDisplay">-- KB</strong></label>
                            </div>
                            <button class="btn-primary btn-large" id="applyCompress">
                                <i class="fas fa-compress"></i> Compress Image
                            </button>
                        </div>
                    </div>

                    <!-- Filters Tab -->
                    <div class="tab-pane" id="filtersTab">
                        <div class="control-section">
                            <h3><i class="fas fa-palette"></i> Image Filters</h3>
                            <div class="control-group">
                                <label for="brightness">Brightness: <span id="brightnessValue">100</span>%</label>
                                <input type="range" id="brightness" min="0" max="200" value="100">
                            </div>
                            <div class="control-group">
                                <label for="contrast">Contrast: <span id="contrastValue">100</span>%</label>
                                <input type="range" id="contrast" min="0" max="200" value="100">
                            </div>
                            <div class="control-group">
                                <label for="saturation">Saturation: <span id="saturationValue">100</span>%</label>
                                <input type="range" id="saturation" min="0" max="200" value="100">
                            </div>
                            <div class="control-group">
                                <label for="blur">Blur: <span id="blurValue">0</span>px</label>
                                <input type="range" id="blur" min="0" max="10" value="0">
                            </div>
                            <div class="filter-presets">
                                <label>Quick Filters:</label>
                                <div class="preset-grid">
                                    <button class="preset-btn" data-filter="grayscale">Grayscale</button>
                                    <button class="preset-btn" data-filter="sepia">Sepia</button>
                                    <button class="preset-btn" data-filter="vintage">Vintage</button>
                                    <button class="preset-btn" data-filter="vibrant">Vibrant</button>
                                    <button class="preset-btn" data-filter="reset">Reset All</button>
                                </div>
                            </div>
                            <button class="btn-primary btn-large" id="applyFilters">
                                <i class="fas fa-check"></i> Apply Filters
                            </button>
                        </div>
                    </div>

                    <!-- Crop Tab -->
                    <div class="tab-pane" id="cropTab">
                        <div class="control-section">
                            <h3><i class="fas fa-crop-alt"></i> Crop Image</h3>
                            <div class="control-group">
                                <label>Original Size: <strong id="cropOriginalSize">-- × -- px</strong></label>
                            </div>
                            <div class="dimension-controls">
                                <div class="control-group">
                                    <label for="cropWidth">Crop Width:</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="cropWidth" placeholder="Width" min="1">
                                        <span class="unit">px</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label for="cropHeight">Crop Height:</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="cropHeight" placeholder="Height" min="1">
                                        <span class="unit">px</span>
                                    </div>
                                </div>
                            </div>
                            <div class="dimension-controls">
                                <div class="control-group">
                                    <label for="cropX">X Offset:</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="cropX" placeholder="0" min="0" value="0">
                                        <span class="unit">px</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label for="cropY">Y Offset:</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="cropY" placeholder="0" min="0" value="0">
                                        <span class="unit">px</span>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="cropRatio">Quick Presets:</label>
                                <select id="cropRatio">
                                    <option value="free">Free Form</option>
                                    <option value="1:1">1:1 (Square)</option>
                                    <option value="4:3">4:3</option>
                                    <option value="16:9">16:9</option>
                                    <option value="3:2">3:2</option>
                                    <option value="2:3">2:3 (Portrait)</option>
                                </select>
                            </div>
                            <div class="crop-info">
                                <p><i class="fas fa-info-circle"></i> Enter dimensions and offset to crop from top-left
                                    corner</p>
                            </div>
                            <button class="btn-primary btn-large" id="applyCrop">
                                <i class="fas fa-check"></i> Apply Crop
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Download Section -->
            <div class="download-section" id="downloadSection" style="display: none;">
                <div class="download-controls">
                    <div class="control-group download-format-group">
                        <label for="downloadFormat">Download Format:</label>
                        <select id="downloadFormat">
                            <option value="png">PNG (Lossless)</option>
                            <option value="jpeg">JPEG</option>
                            <option value="webp">WebP (Modern)</option>
                        </select>
                    </div>
                </div>
                <div class="download-buttons">
                    <button class="btn-success btn-large" id="downloadBtn">
                        <i class="fas fa-download"></i> Download Image
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'core/js/script.js' %}"></script>
{% endblock %}